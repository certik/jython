<HTML>
<!-- THIS PAGE IS AUTOMATICALLY GENERATED.  DO NOT EDIT. -->
<!-- USING THE NEW HT2HTML SCRIPT: Thu Jun 17 15:59:44 1999 -->
<!-- User-specified headers:
Title: Subclassing Java Classes in JPython

-->

<HEAD>
<TITLE>Subclassing Java Classes in JPython</TITLE>

</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000"
      TOPMARGIN="0" LEFTMARGIN="0" MARGINWIDTH="0" MARGINHEIGHT="0"
      LINK="#0000bb"  VLINK="#551a8b"
      ALINK="#ff0000">
<!-- start of page table -->
<TABLE WIDTH="100%" BORDER=0 CELLSPACING=0 CELLPADDING=0>
<!-- start of banner row -->
<TR>
<!-- start of corner cells -->
<TD WIDTH=150 VALIGN=CENTER BGCOLOR="#cdb7b5">

<center>
    <a href="http://www.jpython.org/">
    <img border=0 src="./images/jpython-new-small.gif"></a></center> </TD>
<TD WIDTH=15 BGCOLOR="#cdb7b5">&nbsp;&nbsp;</TD><!--spacer-->
<!-- end of corner cells -->
<!-- start of banner -->
<TD WIDTH="90%" BGCOLOR="#cdb7b5">
<!-- start of site links table -->
<TABLE WIDTH="100%" BORDER=0
CELLSPACING=0 CELLPADDING=2
       COLS=2 ROWS=2 BGCOLOR="#ffffff">
<TR>
    <TD BGCOLOR="#cdb7b5">
<a href="http://www.jpython.org/">Home</a>
    </TD>
    <TD BGCOLOR="#cdb7b5">
<a href="http://www.python.org/">www.python.org</a>
    </TD>
</TR><TR>
    <TD BGCOLOR="#cdb7b5">
<a href="http://www.jpython.org/download.html">Download</a>
    </TD>
    <TD BGCOLOR="#cdb7b5">
<a href="./index.html">Documentation</a>
    </TD>
</TR>
</TABLE><!-- end of site links table -->

</TD><!-- end of banner -->
</TR><!-- end of banner row -->
<TR><!-- start of sidebar/body row -->
<!-- start of sidebar cells -->
<TD WIDTH=150 VALIGN=TOP BGCOLOR="#cdb7b5">
<!-- start of sidebar table -->
<TABLE WIDTH="100%" BORDER=0 CELLSPACING=0 CELLPADDING=3
       BGCOLOR="#ffffff">
<TR><TD BGCOLOR="#660099"><B><FONT COLOR="#ffffff">
Documentation
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="./index.html">Overview</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="whatis.html">Executive Summary</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="interpreter.html">Invoking JPython</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="registry.html">JPython Registry</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="embedding.html">Embedding</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="compile.html">Compiling JPython from source</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">&nbsp;
<TR><TD BGCOLOR="#660099"><B><FONT COLOR="#ffffff">
Working with Java
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="usejava.html">The Basics</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="properties.html">JavaBean Properties</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="jarray.html">Java arrays</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<b>Subclassing</b>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="jpythonc.html">Building applets, servlets, beans...</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">&nbsp;
<TR><TD BGCOLOR="#660099"><B><FONT COLOR="#ffffff">
Python Docs (exits)
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="http://www.python.org/doc/tut/tut.html">Python Tutorial</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="http://www.python.org/doc/lib/lib.html">Library Reference</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">&nbsp;
<TR><TD BGCOLOR="#660099"><B><FONT COLOR="#ffffff">
Other
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="differences.html">JPython vs. CPython</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="faq.html">JPython FAQ</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="http://www.python.org/pipermail/jpython-interest/">List Archives</A> (exit)
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="http://www.python.org/workshops/1997-10/proceedings/hugunin.html">JPython paper</A> (exit)
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">&nbsp;
<TR><TD BGCOLOR="#660099"><B><FONT COLOR="#ffffff">
Email Us
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="mailto:jpython@python.org">jpython@python.org</A>
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
&nbsp;
</TD></TR>
<TR><TD BGCOLOR="#cdb7b5">
<A HREF="http://www.python.org/">
<center>
    <img border=0 src="./images/PythonPoweredSmall.gif"></center>
</A>
</TD></TR>
</TABLE><!-- end of sidebar table -->

</TD>
<TD WIDTH=15>&nbsp;&nbsp;</TD><!--spacer-->
<!-- end of sidebar cell -->
<!-- start of body cell -->
<TD VALIGN=TOP WIDTH="90%"><BR>
<h3>Subclassing Java Classes in JPython</h3>

<h3>A Short Example</h3>

The example below should both demonstrate how this subclassing is
performed and why it is useful.  At first glance, the code looks
exactly like subclassing any other Python class.  The key difference
in this example is that awt.event.ActionListener is a Java class, not
a Python one.  In the 4th line from the end,
"b.addListener(SpamListener())",
a Java method is being called that
requires an instance of the Java class ActionListener. By providing a
Python subclass of this Java class, everybody is happy.

<PRE>
from java import awt

class SpamListener(awt.event.ActionListener):
    def actionPerformed(self,event):
        if event.getActionCommand() == "Spam":
	    print 'Spam and eggs!'
</PRE>

<PRE>
f = awt.Frame("Subclassing Example")
b = awt.Button("Spam")
b.addActionListener(SpamListener())
f.add(b, "Center")
f.pack()
f.setVisible(1)
</PRE>

Note: This example can be accomplished much more elegantly by using
<A HREF="properties.html">JavaBeans properties 
(and event properties)</A>.

<h3>Calling Methods in Your Superclass</h3>

In Python, if I want to call the foo method in my superclass, I use
the form:

<PRE>SuperClass.foo(self)</PRE>

With JPython 1.1, the same thing works even if the superclass is a
Java class.  You no longer need to use the "super__foo()" style call
chain that was required with earlier versions of JPython.

<h3>Example</h3>

The following example shows how the java.io.InputStream class can be
effectively subclassed.  What makes this class difficult is that the
read method is overloaded for three different method signatures:

<OL>
    <LI>abstract int read()</LI>
    <LI>int read(byte[])</LI>
    <LI>int read(byte[], int, int)</LI>
</OL>

The first one of these methods must be overridden in a subclass.
The other two versions can be ignored.  Unfortunately, Python has
no notion of method overloading based on type signatures (this might
be related to the fact that Python doesn't have type signatures
;-)  In order to implement a subclass of java.io.InputStream that
overrides the "read" method, a Python method must be implemented that
handles all three possible cases.  The example below shows the easiest
way to acheive this:

<PRE>
from java.io import InputStream

class InfiniteOnes(InputStream):
    def read(self, *args):
        if len(args) > 0:
	    # int read(byte[])
	    # int read(byte[], int, int)
            return apply(InputStream.read, (self,)+args)
        return 1

io = InfiniteOnes()

for i in range(10):
    print io.read(),
print
</PRE>

<h3>Example Continued</h3>

To continue the example above, this new instance of
java.io.InputStream can be passed to any Java method that expects an
InputStream as shown below:

<PRE>
from java.io import DataInputStream

dp = DataInputStream(io)
dp.skipBytes(1000)
print dp.readByte()
print dp.readShort()
print dp.readInt()
</PRE>

<h3>Invoking Your Superclass's Constructor</h3>

You can explictly invoke your superclass's constructor using the
standard Python syntax of explictly calling the "__init__" method on
the superclass and passing in "self" as the first argument.  If you
wish to call your superclass's constructor, you must do so within your
own "__init__" method.  When your "__init__" method finishes, if your
Java superclasses have not yet been explicitly initialized, their
empty constructors will be called at this point.

<P>It's important to realize that your superclass is not initialized
until you either explictly call it's "__init__" method, or your own
"__init__" method terminates.  You must do one of these two things
before accessing any methods in your superclass.

<h3>Example</h3>

<PRE>
from java.util import Random

class rand(Random):
    def __init__(self, multiplier=1.0, seed=None):
        self.multiplier = multiplier
        if seed is None:
            Random.__init__(self)
        else: 
            Random.__init__(self, seed)

    def nextDouble(self):
        return Random.nextDouble(self) * self.multiplier

r = rand(100, 23)

for i in range(10):
    print r.nextDouble()
</PRE>

This example shows how the superclass's constructor can be effectively
called in order to explictly choose a non-empty version.

<h3>Caching Proxy Classes (Efficiency)</h3>

<b>Note:</b> This section may be out of date, w.r.t. JPython
1.1betaX.  It will be updated before the final release of 1.1.</b>

<p>In order to subclass from a Java class, a Java proxy class must be
created by JPython.  This proxy class is a true Java subclass of the
class you wish to subclass from in Python.  If you do nothing special,
these proxy classes will be created on the fly whenever one is needed.
If you find that the time required for generating these proxies is a
problem, you have two options for convincing JPython to use a cache
instead of recreating them every time.

<P>You can set the "python.proxy.savedir" variable in your registry
file.  You must set this to point to a directory in your Java
Classpath.  I strongly reccommend setting it to &lt;JPYTHON>/JavaCode
where JPython is the directory into which the distribution was
installed.  This will cause JPython to cache copies of any new proxy
classes that it creates.

<P>You can also explicitly create proxy classes with the following
command:

<PRE>java org.python.compiler.ProxyMaker &lt;directory> &lt;classname></PRE>

This will create the proxy class for a given Java class and install it
in the given directory (which must be on your Java Classpath - see
above).

<P>The danger of these caching mechanisms is that JPython currently
has no way to invalidate this cache.  So if you install an improved
version of JPython that produces different proxy files, or if you
modify one of the classes to which you've previously created a proxy,
the change won't be properly handled.  So, only use proxy class
caching if you feel comfortable with JPython already, and if you start
running into problems with proxy classes, my first suggestion is to
disable proxy class caching and to delete your cache directory
(&lt;directory>/org/python/proxies).
</TD><!-- end of body cell -->
</TR><!-- end of sidebar/body row -->
</TABLE><!-- end of page table -->
</BODY></HTML>
